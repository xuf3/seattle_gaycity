<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>LGBTQ community in Seattle</title>
    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/main.css">
    <script src="js/leaflet.js"></script>
    <script src="seattle.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  </head>
  <body>
  <div id="info">
    <div id="title">
      LGBTQ Community Map (2009)
    </div>

    <p><span class="placename">source</span></p>
    <p>Total population: <span id="tp"> N/A</span></p>
    <div class="card-deck counts">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Percent White</h5>
        </div>
        <p class="card-text"><span  id="pwhite" class="county-count">N/A</span></p>
      </div>
      <div class="card">
        <div class="card-body state">
          <h5 class="card-title">Percent Black</h5>
          <p class="card-text">
            <span id="pblack" class="state-count">N/A</span>
          </p>
        </div>
      </div>
    </div>
    <div class="card-deck counts">
      <div class="card">
        <div class="card-body county">
          <h5 class="card-title">Percent Asian</h5>
        </div>
        <p class="card-text"><span id="pasian" class="county-count">N/A</span></p>
      </div>
      <div class="card">
        <div class="card-body state">
          <h5 class="card-title">Percent Hispanic Latino</h5>
          <p class="card-text">
            <span id="phispanic" class="state-count">N/A</span>
          </p>
        </div>
      </div>
    </div>

    <div id="county-chart"></div>

    <div id="footer">
      FOOTER HERE
    </div>

  </div>
    <div id="map"></div>
    <script type="text/javascript">
      //adding the basemap
      var mylayer;
      var mymap = L.map('map',
      {zoomControl: false,center:[47.6062,-122.3321],zoom: 10});
      L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png', {
        	maxZoom: 20,
        	attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
        }).addTo(mymap);

     mylayer = L.geoJSON(false, {style:function (feature) {
     return {fillColor: classificationTP(feature.properties.TotalPopulation),
       weight: 1, opacity: 1, color: 'white', fillOpacity: 0.35}},onEachFeature:onEachFeature}).addTo(mymap);
    $.getJSON("https://opendata.arcgis.com/datasets/b4cf82cdfa2b437eb51ccbfe980aa39e_2549.geojson", function(data){mylayer.addData(data)});

    /*var total = 0;
    for count in mylayer.feature.properties.TotalPopulation:
      total += count;*/

    console.log(total);

        //set the color for each area
        function classificationCN(x){
                    return
                    x > 70? '#08306b';
                    x > 60? '#08519c':
                    x > 50? '#2171b5':
                    x > 30? '#4292c6':
                    x > 15? '#6baed6':
                    x > 5? '#9ecae1':
                    x > 3? '#c6dbef':
                    x > 1? '#deebf7': '#f7fbff';}

      function classificationTP(x){
                  return x > 10000? '#bd0026':
                  x > 8000? '#f03b20':
                  x > 6000? '#fd8d3c':
                  x > 4000? '#feb24c':
                  x > 2000? '#fed976': '#ffffb2';}

        //this function works when there's a click on the map
        //will highlight the layer that the mouse clicked
        function highlightFeature(e) {
        // e indicates the current event
              var layer = e.target; //the target capture the object which the event associates with
              layer.setStyle({
                weight: 2,
                opacity: 0.8,
                color: '#e3e3e3',
                fillColor: '#00ffd9',
                fillOpacity: 0.1
            });}

        // 3.2.2 zoom to the highlighted feature when the mouse is clicking onto it.
        function zoomToFeature(e) {
          // mymap.fitBounds(e.target.getBounds());
          L.DomEvent.stopPropagation(e);
          $("#tp").text(e.target.feature.properties.TotalPopulation);
          $("#pwhite").text(e.target.feature.properties.PWNH);
          $("#pblack").text(e.target.feature.properties.PBNH);
          $("#pasian").text(e.target.feature.properties.PANH);
          $("#phispanic").text(e.target.feature.properties.PHNH);
          //displayPlace(e.target.feature.properties.enname)
        }

        // 3.2.3 reset the hightlighted feature when the mouse is out of its region.
       function resetHighlight(e) {
         mylayer.resetStyle(e.target);
      }

      function onEachFeature(feature, layer) {
      layer.on({
            mouseover: highlightFeature,
            click: zoomToFeature,
            mouseout: resetHighlight
        });}
        //add percentChinese layers

      function showLayer(community){
        if(mylayer){
          mylayer.remove();
        }
        switch (community) {
        case 'white':
            mylayer = L.geoJSON(false, {style:function (feature) {
            return {fillColor: classificationCN(feature.properties.PWNH),weight: 1, opacity: 1, color: 'white', fillOpacity: 0.35}},onEachFeature:onEachFeature});
            break;
        case 'black':
            mylayer = L.geoJSON(false, {style:function (feature) {
            return {fillColor: classificationCN(feature.properties.PWNH),weight: 1, opacity: 1, color: 'white', fillOpacity: 0.35}},onEachFeature:onEachFeature});
            break;
        case 'asian':
            mylayer = L.geoJSON(false, {style:function (feature) {
            return {fillColor: classificationCN(feature.properties.PANH),weight: 1, opacity: 1, color: 'white', fillOpacity: 0.35}},onEachFeature:onEachFeature});
            break;
        case 'hispanic':
            mylayer = L.geoJSON(false, {style:function (feature) {
            return {fillColor: classificationCN(feature.properties.PHNH),weight: 1, opacity: 1, color: 'white', fillOpacity: 0.35}},onEachFeature:onEachFeature});
            break;
        case 'tp':
            mylayer = L.geoJSON(false, {style:function (feature) {
            return {fillColor: classificationTP(feature.properties.TotalPopulation),weight: 1, opacity: 1, color: 'white', fillOpacity: 0.35}},onEachFeature:onEachFeature});
            break;
        }
        mylayer.addTo(mymap);
       $.getJSON("https://opendata.arcgis.com/datasets/b4cf82cdfa2b437eb51ccbfe980aa39e_2549.geojson", function(data){mylayer.addData(data)});
      }

      showLayer('white');


    </script>
  </body>
</html>
